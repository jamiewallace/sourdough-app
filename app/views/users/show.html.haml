%head
  .box-css.col-md-8
    %h1 #{@user.username}'s profile
    .box.avatar
      = image_tag @user.avatar
    .box.description
      Location: 
      = @user.town_city
      %br
      Country: 
      = @user.country
      %br
      %br
      = @user.description
    .box.map
      #map-canvas
    .col-md-2
    %br
      
    

    .box-css.col-md-8 
      -if @user.images.present?
        %h3 #{@user.username}'s photos
        #carousel-example-generic.carousel.slide{"data-ride" => "carousel"}
          / Indicators
          / %ol.carousel-indicators
          /   %li.active{"data-slide-to" => "0", "data-target" => "#carousel-example-generic"}
          /   %li{"data-slide-to" => "1", "data-target" => "#carousel-example-generic"}
          /   %li{"data-slide-to" => "2", "data-target" => "#carousel-example-generic"}
          / Wrapper for slides
          .carousel-inner
            - @user.images.each do |image|
              .item{class: ("active" if @user.images.first.id == image.id)}
                = image_tag image.image_url(:thumb)
          / Controls
          %a.left.carousel-control{"data-slide" => "prev", href: "#carousel-example-generic"}
            %span.glyphicon.glyphicon-chevron-left
          %a.right.carousel-control{"data-slide" => "next", href: "#carousel-example-generic"}
            %span.glyphicon.glyphicon-chevron-right
    
      = form_for @image do |f| 
        .field

        -if current_user  
          %br Upload images of your triumphs (and tragedies)
          %br
          = f.file_field :image
          %br
          .actions
          = f.submit 'Save'  
  
  .box-css.col-md-3.messaging
    - if current_user
      - if current_user.id != @user.id
        %h3 Message #{@user.username}
        #message-thread
          - @message_thread.each do |message|
            = render message, :locals => {:message => message}
            
        %h4 Send a message to #{@user.username}
        #message-compose
          = form_for @new_message do |f|
            = f.hidden_field :recipient_id
            = f.hidden_field :sender_id
            .form-group
              = f.text_area :content, {:class => 'form-control', :rows => 5}
            = f.submit 'Send', {:class => 'btn btn-primary', :id => "send-message"}
    - else
      %h3 
        = link_to "Sign up" , new_user_registration_path(ref_user_id: @user.id)
        or
        = link_to "Sign in" , new_user_session_path(ref_user_id: @user.id)
        to send a message to
        = "#{@user.username}"
        
%script{:async => "", :src => "//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"}
/ Jamie Wallace
%ins.adsbygoogle{"data-ad-client" => "ca-pub-8447293650663384", "data-ad-slot" => "3985446907", :style => "display:inline-block;width:728px;height:90px"}

  :javascript
  (adsbygoogle = window.adsbygoogle || []).push({});
 
  :javascript
  $(window).load(function() {
      $('#slider').nivoSlider();
  });

  :javascript
    window.user_location = {lat: #{@user.lat}, lon:#{@user.lon}}